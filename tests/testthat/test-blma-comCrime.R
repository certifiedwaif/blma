context('blma comCrime')
get_comCrime  <- function()
{
    # Fill in
    data(comData)
    Y <- comData[, 1:18]
    X <- comData[, 19:142]
    # Data preparation

    sum.na <- function(x) {  sum(is.na(x)); }
    inds <- which(apply(X,2,sum.na)==0)
    X2 <- X[,inds]
    X3 <- X2[,!colnames(X2)%in%c("ownHousQrange","rentQrange")]

    y <- Y[, 18]
    inds <- which(is.na(y))

    vy <- y[-inds]
    mX <- X3[-inds,] %>% as.matrix
    mX.til <- cbind(1,mX)

    n <- length(vy)
    p <- ncol(mX)

    mult <- sqrt(n/(n-1))
    mX <- mX
    for (j in 1:p) {
      mX[,j] = mult*(mX[,j] - mean(mX[,j]))/sd(mX[,j])
    }
    vy <- mult*(vy - mean(vy))/sd(vy)
    return(list(vy=vy, mX=mX))
}
normalize <- function(y, X)
{
  n <- length(y)
  p <- ncol(X)

  mu.y <- mean(y)
  sigma2.y <- (n - 1) * var(y) / n
  vy <- (y - mu.y) / sqrt(sigma2.y)

  # Normalise covariates
  mX <- matrix(0, n, p)
  mu.x <- c()
  sigma2.x <- c()
  for (j in 1:p)
  {
    mu.x[j] <- mean(X[, j])
    sigma2.x[j] <- (n - 1) * var(X[, j]) / n
    mX[, j] <- (X[, j] - mu.x[j]) / sqrt(sigma2.x[j])
  }

  return(list(vy = vy, mX = mX, mu.y = mu.y, sigma2.y = sigma2.y, mu.x = mu.x, sigma2.x = sigma2.x))
}
test_that('comCrime produces correct results BIC', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='BIC', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.7934,
0.0062,
0.009299999999999999,
0.0687,
0.0183,
0.3268,
0.0028,
0.0037,
0.0025,
0.0066,
0.155,
0.002,
0.0864,
0.009599999999999999,
0.0015,
0.0024,
0.0035,
0.0053,
0.0018,
0.0259,
0.0036,
0.0048,
0.0045,
0.0031,
0.002,
0.0024,
0.0421,
0.0055,
0.0126,
0.0021,
0.003,
0.0025,
0.0039,
0.0011,
0.0045,
0.0019,
0.0021,
0.0032,
0.0017,
0.9311,
0.06909999999999999,
0.0024,
0.0867,
0.9063,
0.0024,
0.0075,
0.0015,
0.0017,
0.7648,
0.9902,
0.7544999999999999,
0.0126,
0.015,
0.1468,
0.7642,
0.0098,
0.0057,
0.0134,
0.0124,
0.4452,
0.0279,
0.0081,
0.0061,
0.0034,
0.0026,
0.0039,
0.008699999999999999,
0.0046,
0.0018,
0.0013,
0.3617,
0.0112,
0.004,
0.0019,
0.0135,
0.0018,
0.0037,
0.0161,
0.4112,
0.2047,
0.2292,
0.0023,
0.0054,
0.0048,
0.0153,
0.0018,
0.0275,
0.0016,
0.0346,
0.1446,
0.0241,
0.0016,
0.0297,
0.0015,
0.0023,
0.002,
0.0017,
0.001,
0.3594)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results ZE', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='ZE', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.9026999999999999,
0.0254,
0.0226,
0.129,
0.0342,
0.3135,
0.0048,
0.0178,
0.0052,
0.0343,
0.09569999999999999,
0.0043,
0.0732,
0.0292,
0.0045,
0.0052,
0.0103,
0.0127,
0.0046,
0.0328,
0.0102,
0.0122,
0.0105,
0.008500000000000001,
0.0054,
0.0042,
0.0495,
0.0116,
0.0198,
0.006,
0.0052,
0.006,
0.0122,
0.004,
0.0083,
0.0047,
0.0064,
0.0101,
0.005,
0.8814,
0.1174,
0.0074,
0.1386,
0.8524,
0.0063,
0.0222,
0.005,
0.0039,
0.8771,
0.9852,
0.8823,
0.0111,
0.0169,
0.1733,
0.7507,
0.0091,
0.0075,
0.0151,
0.0109,
0.5032,
0.0388,
0.0138,
0.0083,
0.0115,
0.0083,
0.0104,
0.0177,
0.0091,
0.0056,
0.0046,
0.6135,
0.0233,
0.0122,
0.0039,
0.0268,
0.0045,
0.0045,
0.039,
0.4423,
0.2069,
0.2239,
0.0063,
0.0127,
0.0083,
0.0115,
0.0051,
0.0414,
0.004,
0.0736,
0.1794,
0.0299,
0.0057,
0.0436,
0.0054,
0.0052,
0.0053,
0.0042,
0.0053,
0.4034)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results liang_g1', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='liang_g1', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.9198757119159278,
0.07501274306903849,
0.03852284736827773,
0.1947137280723433,
0.04855392031090839,
0.3569,
0.0133,
0.0309,
0.0128,
0.0738,
0.091,
0.0122,
0.08450000000000001,
0.0601,
0.0102,
0.0105,
0.0252,
0.0197,
0.0145,
0.04,
0.0257,
0.0284,
0.0263,
0.0203,
0.0127,
0.0113,
0.0553,
0.0247,
0.037,
0.0132,
0.0189,
0.0123,
0.0218,
0.0104,
0.0206,
0.0086,
0.011,
0.0194,
0.0106,
0.857,
0.1391,
0.0186,
0.1246,
0.8738,
0.0166,
0.0422,
0.0104,
0.008699999999999999,
0.9074,
0.9877,
0.9326,
0.0227,
0.024,
0.1408,
0.7551,
0.0175,
0.0169,
0.0204,
0.0192,
0.446,
0.047,
0.0283,
0.0182,
0.0262,
0.0177,
0.0264,
0.0348,
0.0196,
0.0136,
0.01,
0.7468,
0.0382,
0.02,
0.0113,
0.0511,
0.0123,
0.0104,
0.0709,
0.4005,
0.2181,
0.2414,
0.0094,
0.0141,
0.0168,
0.022,
0.0089,
0.0862,
0.0083,
0.1246,
0.2318,
0.0336,
0.0089,
0.1035,
0.0131,
0.0104,
0.011,
0.0108,
0.0105,
0.5023)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results liang_g2', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='liang_g2', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.9214757119159278,
0.0700127430690385,
0.03702284736827773,
0.1937137280723433,
0.05445392031090839,
0.3472,
0.0152,
0.0244,
0.0167,
0.0717,
0.0906,
0.0138,
0.0848,
0.0522,
0.0089,
0.0123,
0.0317,
0.0193,
0.0109,
0.0439,
0.0234,
0.026,
0.0247,
0.0205,
0.0141,
0.0115,
0.055,
0.0231,
0.0364,
0.0129,
0.0168,
0.0149,
0.0221,
0.01,
0.017,
0.008500000000000001,
0.0102,
0.0211,
0.0114,
0.8509,
0.1493,
0.0189,
0.1393,
0.8571,
0.0171,
0.0445,
0.0111,
0.0091,
0.9073,
0.9843,
0.9286,
0.0215,
0.0248,
0.1559,
0.741,
0.0141,
0.0166,
0.0214,
0.0185,
0.4672,
0.0437,
0.0274,
0.018,
0.0229,
0.0166,
0.0232,
0.0335,
0.0192,
0.0135,
0.009299999999999999,
0.7498,
0.0364,
0.0176,
0.0078,
0.0496,
0.0117,
0.0118,
0.06859999999999999,
0.3969,
0.2435,
0.2154,
0.01,
0.0165,
0.0146,
0.0245,
0.0072,
0.0922,
0.009299999999999999,
0.1217,
0.2359,
0.0336,
0.0086,
0.1148,
0.0147,
0.0108,
0.0089,
0.0094,
0.0098,
0.4964)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results liang_g_n_approx', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='liang_g_n_approx', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.9153757119159278,
0.07101274306903849,
0.03702284736827773,
0.1884137280723433,
0.05055392031090839,
0.3676,
0.0146,
0.0241,
0.013,
0.0706,
0.0939,
0.0097,
0.0911,
0.0506,
0.0092,
0.01,
0.0274,
0.0182,
0.0127,
0.0309,
0.0199,
0.026,
0.0183,
0.0181,
0.0121,
0.0133,
0.0613,
0.0218,
0.0321,
0.0147,
0.0157,
0.0111,
0.0212,
0.0089,
0.0182,
0.0108,
0.008500000000000001,
0.0172,
0.0119,
0.8166,
0.1811,
0.0163,
0.1522,
0.8389,
0.0157,
0.0388,
0.0106,
0.0104,
0.8971,
0.9802,
0.9184,
0.0167,
0.0191,
0.1262,
0.7783,
0.0122,
0.0135,
0.0172,
0.0168,
0.4401,
0.0517,
0.0241,
0.0142,
0.0218,
0.0143,
0.0223,
0.0276,
0.0169,
0.0123,
0.0083,
0.7383,
0.0338,
0.0215,
0.008399999999999999,
0.0431,
0.0137,
0.0112,
0.0607,
0.3965,
0.2449,
0.2247,
0.0071,
0.0132,
0.0147,
0.0176,
0.009599999999999999,
0.0887,
0.008999999999999999,
0.112,
0.2387,
0.0364,
0.0095,
0.1068,
0.0135,
0.0105,
0.0092,
0.0095,
0.008500000000000001,
0.4833)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results liang_g_n_quad', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='liang_g_n_quad', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.8896757119159278,
0.05421274306903849,
0.02882284736827773,
0.1577137280723433,
0.04495392031090839,
0.3529,
0.0118,
0.0176,
0.0119,
0.0572,
0.1199,
0.0098,
0.07820000000000001,
0.0502,
0.0086,
0.0091,
0.0231,
0.0176,
0.008999999999999999,
0.0319,
0.0196,
0.0201,
0.0237,
0.0155,
0.0114,
0.009299999999999999,
0.0551,
0.0206,
0.025,
0.0116,
0.0167,
0.0128,
0.0169,
0.008800000000000001,
0.0156,
0.0057,
0.0075,
0.0159,
0.0081,
0.8404,
0.1605,
0.0122,
0.1335,
0.8647,
0.013,
0.0351,
0.008,
0.008999999999999999,
0.8921,
0.9874000000000001,
0.9129,
0.0202,
0.0233,
0.1338,
0.7778,
0.0127,
0.016,
0.0205,
0.0147,
0.4718,
0.0498,
0.021,
0.0136,
0.0186,
0.0126,
0.0178,
0.029,
0.0144,
0.012,
0.008399999999999999,
0.7137,
0.0363,
0.0184,
0.0068,
0.0408,
0.0106,
0.0086,
0.0629,
0.4427,
0.2135,
0.2125,
0.0101,
0.0158,
0.012,
0.0237,
0.0083,
0.0765,
0.0083,
0.107,
0.2223,
0.0297,
0.008200000000000001,
0.0866,
0.012,
0.0092,
0.008399999999999999,
0.008500000000000001,
0.007900000000000001,
0.4732)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results robust_bayarri1', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='robust_bayarri1', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.9232757119159278,
0.05741274306903849,
0.03742284736827773,
0.1815137280723433,
0.04405392031090839,
0.3515,
0.0123,
0.0155,
0.0121,
0.0562,
0.0862,
0.0106,
0.075,
0.0494,
0.0074,
0.0095,
0.0264,
0.0167,
0.0091,
0.0286,
0.0185,
0.022,
0.0206,
0.0159,
0.0091,
0.0091,
0.0596,
0.018,
0.0289,
0.0131,
0.0152,
0.0114,
0.0176,
0.0055,
0.0154,
0.008999999999999999,
0.0074,
0.0162,
0.0092,
0.8622,
0.1342,
0.0138,
0.1654,
0.8372000000000001,
0.0109,
0.0367,
0.008999999999999999,
0.0078,
0.8939,
0.9931,
0.9141,
0.0216,
0.0268,
0.1315,
0.7723,
0.0129,
0.0156,
0.0146,
0.0169,
0.4625,
0.0532,
0.0192,
0.0154,
0.0192,
0.0122,
0.0149,
0.0296,
0.0129,
0.009599999999999999,
0.0061,
0.7195,
0.0272,
0.0173,
0.007900000000000001,
0.0407,
0.0094,
0.009299999999999999,
0.0588,
0.4325,
0.2244,
0.2143,
0.008500000000000001,
0.0143,
0.0104,
0.0218,
0.0073,
0.07870000000000001,
0.007900000000000001,
0.1031,
0.2191,
0.0297,
0.0071,
0.0927,
0.01,
0.0097,
0.0067,
0.0092,
0.008,
0.4742)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results robust_bayarri2', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='robust_bayarri2', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.9350757119159278,
0.05851274306903849,
0.03092284736827773,
0.1622137280723433,
0.03895392031090839,
0.343,
0.0102,
0.0179,
0.0112,
0.0563,
0.0711,
0.0095,
0.0844,
0.0442,
0.0089,
0.0069,
0.0217,
0.0166,
0.0086,
0.0354,
0.0191,
0.0236,
0.0213,
0.0158,
0.0105,
0.008399999999999999,
0.0518,
0.0177,
0.026,
0.0107,
0.013,
0.008699999999999999,
0.0185,
0.008399999999999999,
0.0173,
0.0073,
0.0105,
0.0168,
0.008200000000000001,
0.8310999999999999,
0.1669,
0.009599999999999999,
0.1326,
0.8686,
0.0128,
0.0342,
0.008399999999999999,
0.0077,
0.9097,
0.9905,
0.9312,
0.0195,
0.0209,
0.1454,
0.7622,
0.0134,
0.0112,
0.018,
0.0159,
0.4837,
0.0429,
0.0222,
0.0146,
0.0145,
0.0129,
0.021,
0.0281,
0.0151,
0.0102,
0.0064,
0.7423,
0.0309,
0.0168,
0.008,
0.0412,
0.0103,
0.008699999999999999,
0.0621,
0.4339,
0.2032,
0.2289,
0.0094,
0.0143,
0.0118,
0.0188,
0.0069,
0.07149999999999999,
0.008,
0.107,
0.2147,
0.0328,
0.0055,
0.0891,
0.0115,
0.0081,
0.0083,
0.0069,
0.0091,
0.4577)
, tolerance = 1e-8)
})
test_that('comCrime produces correct results zellner_siow_gauss_laguerre', {
    comCrime <- get_comCrime()
    vy <- comCrime$vy
    mX <- comCrime$mX
    result <- sampler(10000, vy, mX, prior='zellner_siow_gauss_laguerre', modelprior='uniform', cores=1)
    expect_equal(result$vinclusion_prob, c(0.8629757119159278,
0.02891274306903849,
0.02222284736827773,
0.1175137280723433,
0.02695392031090839,
0.3031,
0.0073,
0.0138,
0.008699999999999999,
0.0374,
0.1358,
0.0045,
0.0868,
0.0296,
0.0034,
0.0047,
0.0149,
0.0136,
0.007,
0.0344,
0.01,
0.0129,
0.0139,
0.0094,
0.0077,
0.0064,
0.0526,
0.0135,
0.0232,
0.0064,
0.007,
0.0056,
0.0102,
0.0046,
0.0104,
0.0055,
0.0048,
0.0091,
0.0047,
0.8866000000000001,
0.1147,
0.0072,
0.1092,
0.8783,
0.0065,
0.0212,
0.0038,
0.0043,
0.8704,
0.982,
0.8803,
0.0145,
0.0179,
0.1543,
0.7707000000000001,
0.0094,
0.0071,
0.0143,
0.0098,
0.5109,
0.0369,
0.0155,
0.0089,
0.0101,
0.008399999999999999,
0.0139,
0.0147,
0.01,
0.006,
0.0043,
0.6128,
0.0241,
0.0098,
0.0043,
0.0312,
0.0048,
0.0056,
0.0416,
0.3912,
0.2466,
0.2158,
0.0051,
0.0141,
0.008200000000000001,
0.0195,
0.0044,
0.046,
0.0062,
0.0722,
0.1793,
0.0298,
0.0047,
0.0509,
0.006,
0.0051,
0.0055,
0.0048,
0.0052,
0.4031)
, tolerance = 1e-8)
})
